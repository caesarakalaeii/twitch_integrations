<!DOCTYPE html>
<html>
<% let msg = 0; %>
<% function oddEven() { return msg++ % 2 ? 'odd': 'even' }; %>
<% function streakCalc(streak) {
  if(streak < 6){
    return 'less_six'
  } else if( streak < 12){
    return 'less_twelve'
  } else {
    return 'more_twelve'
  }
}; %>
<% function getTier(tier){
  if(tier == 3){
    return '3'
  } else if (tier == 2){
    return '2'
  } else {
    return ''
  }
} %>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Credits</title>
  <link rel="stylesheet" href="/content/style.css" />
  <% if (!noScroll) { %><script src="/content/scroll.js"></script><% } %>
  <script src="/content/clip.js"></script>
  <script src="/content/data.js"></script>
</head>

<body>

<!-- BEGIN CLIPS -->
<% if (clips && clips?.length) { %>
<% clips.sort((a, b) => new Date(b.creationDate).getTime() - new Date(a.creationDate).getTime()).forEach((clip, i) => { %>
  <div class="clip controller" data-clip-id="<%= clip.id %>"></div>

  <div class="clip fixed background" data-clip-id="<%= clip.id %>">
    <video poster="<%= clip.thumbnailUrl %>" <% if (!unmuted) { %>muted<% } %> <% if (autoplay) { %>autoplay<% } %>>
      <source src="/clip/<%= clip.id %>" type="video/mp4"/>
    </video>
  </div>

  <div class="clip fixed foreground" data-clip-id="<%= clip.id %>">
    <div class="info left">
      <!-- <%- JSON.stringify(clip, null, '  ') %> -->
      <div class="title">
        <q><%= clip.title %></q>
      </div>
      <div class="created-by line">
        <img class="avatar" src="<%= clip.creator.profilePictureUrl %>" />
        <div class="stack">
          <span class="username"><%= clip.creatorDisplayName %></span>
          <span data-date="<%= new Date(clip.creationDate).toISOString() %>"></span>
        </div>
      </div>
    </div>

    <div class="info right">
      <div class="game">
        <div class="title"><%= clip.game.name %></div>
        <img class="box-art" src="<%= clip.game.boxArtUrl.split(/-\{width\}x\{height\}/i).join('') %>">
      </div>
    </div>
  </div>
<% }) %>
<% } %>
<!-- END CLIPS -->

<div id="scroll" class="scroll-container">
  <div class="scroll-content">
  <div class="header grad-text">Thanks for watching!</div>
<!-- BEGIN GIFTED -->
  <% if (gifted && gifted?.length) { %>
  <div class="list_title">Gifted Subs:</div>
  <div class="list_container ranking">
    <% gifted.sort((a, b) => b.amount - a.amount).forEach(function(event) { %>
      <div class="list_item message <%= oddEven() %>">
        <span class="username">
          <%= event.user %>
        </span>
        <span class="amount">
          <%= event.amount %>
        </span>
      </div>
    <% }) %>
  </div>
  <% } %>
<!-- END GIFTED -->

<!-- BEGIN NEWSUBS -->
  <% if ((newSubs && newSubs?.length) ||(streaks && streaks?.length)) { %>
  <div class="list_title">New Subscriptions:</div>
  
  <div class="list_container" id="new_subs">
    <% streaks.forEach(function(event){ %>
      <div class="list_item message <%= oddEven() %>">
        <div class="saiyan<%=getTier(event.tier)%>" >
            <%= event.user %>
        </div>
        
        <div class="vert_container">
          <span class="streak">
            <div class="streak_length<%streakCalc(event.streak)%>">
              <%= event.streak%>
            </div>
            <% if(event.streak != event.full_amount) {%>
              <div class="streak">
                <%= event.full_amount%>
              </div>
            <% } %>
          </span>
        </div>
        <span class="message <%= oddEven() %>">
            <%= event.message %>
        </span>
            
        </div>
        <% }) %>
        <% newSubs.forEach(function(event) { %>
          <div class="list_item message <%= oddEven() %>">
            <span class="username">
              <%= event %>
            </span>
          </div>
  <% }) %>
  <% } %>
  </div>
<!-- END NEWSUBS -->

<!-- BEGIN CHEERS -->
  <% if (cheers && cheers?.length){%>
  <div class="list_title">Cheers:</div>
  <div class="list_container">
    <% cheers.sort((a, b) => b.amount - a.amount).forEach(function(event) { %>
      <div class="list_item">
        <img class="inline-icon" src="/content/diamond.png">
        <span class="amount"><%= event.amount %></span>
        <span class="username"><%= event.user %></span>
        <div class="vert_container">
          <% event.messages.forEach(function(m) { %>
            <div class="message <%= oddEven() %>"><%= m %></div>
          <% }) %>
        </div>
      </div>
    <% }) %>
  </div>
  <% } %>
<!-- END CHEERS -->
  
<!-- BEGIN RAIDS -->
  <% if (raids && raids?.length) { %>
    <div class="list_title">Thanks to the Raiders:</div>
    <div class="list_container">
      <% raids.sort((a, b) => b.amount - a.amount).forEach(function(event) { %>
        <div class="list_item message <%= oddEven() %>">
          <span class="username">
            <%= event.user %>
          </span>
          <span class="amount">
            <%= event.amount %>
          </span>
        </div>
      <% }) %>
    </div>
  <% } %>
<!-- END RAIDS -->

<!-- BEGIN FULL SUBS -->
  <% if (subs && subs?.length) { %>
  <div class="list_title">Subscriptions</div>
  <div class="list_container">
    <% for (const sub of subs.filter((sub => sub.broadcasterId !== sub.userId))) { %>
      <!-- <%- JSON.stringify(sub, null, '  ') %> -->
      <div class="list_item">
        <% if (sub.user) { %>
          <img class="avatar" src="<%= sub.user.profilePictureUrl %>" />
        <% } %>
        <span class="username"><%= sub.userDisplayName %></span>
        <% if (sub.isNew) { %><span class="new_badge">NEW</span><% } %>
        <% if (sub.isGift) { %><span class="gifter username"><%= sub.gifterDisplayName %></span><% } %>
        <% if (sub.durationMonths) { %><span class="duration months"><%= sub.durationMonths %></span><% } %> 
      </div>
    <% } %>
  </div>
  <% } %>
<!-- END FULL SUBS -->

<!-- BEGIN REDEEMS -->
  <% if (redeems && redeems?.length) {%>
  <div class="list_title">Redeems:</div>
  <div class="list_container">
    <% redeems.forEach(function(event) { %>
      <div class="list_item">
        <span class="username">
          <%= event.user %>
        </span>
        <span class="message <%= oddEven() %>">
          <%= event.message %>
        </span>
      </div>
    <% }) %>
  </div>
  <% } %>
<!-- END REDEEMS -->
  
<!-- BEGIN FOLLOWS -->
  <% if (follows && follows?.length) { %>
  <div class="list_title">Follows:</div>
  <p class="list_no_break">
    <% follows.forEach(function(user, index) { %>
    <span class="comma_separated"><%= user %></span>
    <% }) %>
  </p>
  <% } %>
<!-- END FOLLOWS -->
  
  <div class="closure grad-text">Sweet dreams of sour pickles</div>
  <div class="credit_where_credit_is_due">Developed by Kouna and CaesarLP</div>
</div></div>
</body>

</html>